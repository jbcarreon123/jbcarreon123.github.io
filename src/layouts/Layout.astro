---
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";
import { version } from "../../package.json";
import { Image } from "astro:assets";

const { title, id, description } = Astro.props;

import Windows from "../components/Windows.astro";
import CommonHead from "../components/CommonHead.astro";
import Sidebar from "../components/Sidebar.astro";

const hash = import.meta.env.COMMIT_HASH ?? 'null';
---

<!doctype html>
<html lang="en" class="inter" data-color="dark">
	<head>
		<CommonHead title={title} id={id} description={description} />
	</head>
	<body class="jcolor">
		<script is:inline>
			function loadTooltip() {
				console.log('loading tooltip event listener');
				let tooltip = document.querySelector('.hover--tooltip');
				document.querySelectorAll("*:not(a) img").forEach((img) => {
					if (!img.alt && !img.title) return;
					img.addEventListener('mousemove', (mev) => {
						tooltip?.style.setProperty('--x', mev.clientX + 'px');
						tooltip?.style.setProperty('--y', mev.clientY + 'px');
						tooltip?.style.setProperty('display', 'block');
						tooltip.innerHTML = `<p>${img.title ? img.title : img.alt}</p>`;
						img?.removeAttribute('title');
					});
					img.addEventListener('mouseleave', () => {
						tooltip?.style.setProperty('display', 'none');
					});
				});
				document.querySelectorAll("a").forEach((el) => {
					if (window.location.hostname === new URL(el.href).hostname) return;
					el.addEventListener('mousemove', (mev) => {
						tooltip?.style.setProperty('--x', mev.clientX + 'px');
						tooltip?.style.setProperty('--y', mev.clientY + 'px');
						tooltip?.style.setProperty('display', 'block');
						let img = el.querySelector('img');
						tooltip.innerHTML = `${img ? `<p>${img.title ? img.title : img.alt}</p>` : ''}
<p class="small">${el.href}${el.target === '_blank' ? ' <span class="ms">open_in_new</span>' : ''}</p>`;
						img?.removeAttribute('title');
					});
					el.addEventListener('mouseleave', () => {
						tooltip?.style.setProperty('display', 'none');
					})
				});
			}
			document.addEventListener('DOMContentLoaded', loadTooltip);
			document.addEventListener('load', loadTooltip);
			document.addEventListener('astro:page-load', loadTooltip);
			document.addEventListener('astro:after-swap', loadTooltip);
		</script>
		<div class="hover--tooltip">

		</div>
		<style>
			.hover--tooltip {
				position: fixed;
				left: calc(var(--x) + 15px);
				top: calc(var(--y) + 15px);
				transition: none;
				z-index: 99999;
				background: var(--altbg);
				padding: 6px;
				max-width: 350px;
			}
		</style>
		<div class="container" transition:animate="none">
			<main id="main">
				<header>
					<a href="#sidebar">Menu</a> <p class="page-title">{title ? title : "jb's site"}</p>
				</header>
				<div>
					<div id="content" transition:animate="slide">
						<slot />
					</div>
					<footer transition:persist transition:animate="none">
						<div class="sec">
							<p class="small">
								jbsite4@{version}/{hash} Â© 2025 jbcarreon123. All rights
								reserved.
							</p>
							<p class="small">
								Site content are licensed under CC BY-SA 4.0
								unless specified.
							</p>
							<p class="small">
								Made in Astro and Bun, hosted in Nekoweb
							</p>
							<p class="small">
								<a
									href="https://maxpixels.moe/manifesto/"
									target="_blank"
									>Copying is an act of theft, while taking
									inspiration is the true act of love. <span
										class="ms">open_in_new</span
									></a
								>
							</p>
						</div>
						<div class="right">
							<a
								target="_blank"
								rel="noopener"
								class="w-fit shrink-0"
								href="https://developer.mozilla.org/en-US/docs/Web/SVG/SVG_animation_with_SMIL"
							>
								<Image
									src="/imgs/buttons/smil.svg"
									alt="Enhanced with SMIL :D"
									title="Enhanced with SMIL :D"
									width="88px"
									height="31px"
								/>
							</a>
							<a
								target="_blank"
								rel="noopener"
								class="w-fit shrink-0"
								href="https://team.indieseas.net"
							>
								<Image
									src="/imgs/buttons/indiefellas.svg"
									alt="Indiefellas"
									title="indieweb devs with no idea what they're doing"
									width="88px"
									height="31px"
								/>
							</a>
							<a
								target="_blank"
								rel="noopener"
								class="w-fit shrink-0"
								href="https://nekoweb.org/"
								><Image
									src="https://nekoweb.org/assets/buttons/button5.gif"
									loading="lazy"
									alt="Nekoweb"
									title="Nekoweb (button by maxpixels)"
									width="88px"
									height="31px"
								/></a
							>
							<a
								href="https://districts.nekoweb.org/"
								target="_blank"
								><Image
									alt="Nekoweb Districts"
									title="Nekoweb Districts"
									src="https://districts.nekoweb.org/img/districts002.png"
									width="88px"
									height="31px"
								/>
								<a
									target="_blank"
									class="w-fit shrink-0"
									href="https://kalechips.net/responsive/index"
								>
									<Image
										src="/imgs/buttons/responsive-web-directory.png"
										alt="Responsive Web Directory"
										title="Responsive Web Directory"
										width="88px"
										height="31px"
									/>
								</a>
								<Image
									src="/imgs/buttons/mobilefriendly.png"
									alt="Mobile friendly"
									title="This site is mobile friendly!"
									width="88px"
									height="31px"
								/>
							</a>
						</div>
					</footer>
				</div>
			</main>
			<Sidebar title={title} id={id} description={description} />
		</div>

		<div transition:persist>
			<Windows />
		</div>
	</body>
</html>

