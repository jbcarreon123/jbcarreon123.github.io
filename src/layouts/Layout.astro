---
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";
import { version } from "../../package.json";
import { Image } from "astro:assets";

const { title, id, description } = Astro.props;
const { url, site } = Astro;
import { OgImage } from "astro-opengraph-image/components";

const ogImage = url
	.toString()
	.replace("/posts/", "/post-og/")
	.replace(/\/$/, "");
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="generator" content={Astro.generator} />
		<title>{title ? title : "jb's site"}</title>
		<meta name="description" content={description} />

		<link
			rel="preload"
			href="/fonts/CommitMono-Variable.ttf"
			as="font"
			type="font/ttf"
			crossorigin
		/>
		<link
			rel="preload"
			href="/fonts/Inter-Variable.ttf"
			as="font"
			type="font/ttf"
			crossorigin
		/>
		<link
			rel="preload"
			href="/fonts/MaterialSymbols.woff2"
			as="font"
			type="font/woff2"
			crossorigin
		/>

		<!-- Meta tags -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:url" content={url} />
		<meta
			property="og:type"
			content={url.pathname.includes("posts") ? "article" : "website"}
		/>
		<meta property="twitter:image" content={ogImage + ".png"} />

		<!-- Alternate links -->
		<link
			rel="alternate"
			type="application/rss+xml"
			title="jb's posts"
			href={new URL("feed.xml", Astro.site)}
		/>
		<link
			rel="alternate"
			type="application/atom+xml"
			title="jb's posts"
			href={new URL("feed.atom", Astro.site)}
		/>
		<link
			rel="alternate"
			type="application/json"
			title="jb's posts"
			href={new URL("feed.json", Astro.site)}
		/>

		<!-- Scripts and stuff -->
		<ClientRouter />

		<script is:inline>
			Array.prototype.sample = function () {
				return this[Math.floor(Math.random() * this.length)];
			};

			function load() {
				setTimeout(() => {
					document.querySelector(".motd").textContent = [
						"ctrl + c and ctrl + v are the most used shortcuts",
						"hello, we're trying to reach you for your site's extended warranty",
						"nekonekoweb",
						"hmm",
						"your resident helper",
						"made in astro and bun",
						"a person that stares on his text editor",
					].sample();
				}, 250);

				document
					.querySelectorAll(".page-title")
					.forEach((el) => (el.textContent = document.title));

				let v = window.scrollY;
				document.querySelector("#main").scrollIntoView();
				window.scroll(window.scrollX,v);
			}

			document.addEventListener("astro:page-load", () => {
				let el = document.querySelector("aside")?.dataset.activePage;
				document.querySelectorAll("nav a").forEach((e) => {
					if (e.id === el) {
						e.classList.add("active");
						if (e.parentNode.tagName.toLowerCase() === 'details') {
							e.parentElement.setAttribute('open', true)
							console.log(e.parentElement)
							console.log("open details")
						}
					} else {
						e.classList.remove("active");
					}
				});

				document.querySelector('header a').addEventListener('click', (e) => {
					e.preventDefault();

					let sidebar = document.getElementById('sidebar');
					let main = document.getElementById('main');

					if (sidebar.classList.contains('visible')) {
						sidebar.classList.remove('visible');
						main.scrollIntoView();
					} else {
						sidebar.classList.add('visible');
						sidebar.scrollIntoView();
					}
				})
			})
			document.addEventListener("astro:after-swap", () => load());
		</script>
	</head>
	<body class="jcolor">
		<div class="container" transition:animate="none">
			<main id="main">
				<header>
					<a href="#sidebar">Menu</a> <p class="page-title">{title ? title : "jb's site"}</p>
				</header>
				<div>
					<div id="content" transition:animate="slide">
						<slot />
					</div>
					<footer transition:persist transition:animate="none">
						<div class="sec">
							<p class="small">
								jbsite4@{version} Â© 2025 jbcarreon123. All rights
								reserved.
							</p>
							<p class="small">
								Site content are licensed under CC BY-SA 4.0
								unless specified.
							</p>
							<p class="small">
								Made in Astro and Bun, hosted in Nekoweb
							</p>
							<p class="small">
								<a
									href="https://maxpixels.moe/manifesto/"
									target="_blank"
									>Copying is an act of theft, while taking
									inspiration is the true act of love. <span
										class="ms">open_in_new</span
									></a
								>
							</p>
						</div>
						<div class="right">
							<a
								target="_blank"
								rel="noopener"
								class="w-fit shrink-0"
								href="https://developer.mozilla.org/en-US/docs/Web/SVG/SVG_animation_with_SMIL"
							>
								<Image
									src="/imgs/buttons/smil.svg"
									alt="Enhanced with SMIL :D"
									title="Enhanced with SMIL :D"
									width="88px"
									height="31px"
								/>
							</a>
							<a
								target="_blank"
								rel="noopener"
								class="w-fit shrink-0"
								href="https://team.indieseas.net"
							>
								<Image
									src="/imgs/buttons/indiefellas.svg"
									alt="Indiefellas"
									title="indieweb devs with no idea what they're doing"
									width="88px"
									height="31px"
								/>
							</a>
							<a
								target="_blank"
								rel="noopener"
								class="w-fit shrink-0"
								href="https://nekoweb.org/"
								><Image
									src="https://nekoweb.org/assets/buttons/button5.gif"
									loading="lazy"
									alt="Nekoweb"
									title="Nekoweb (button by maxpixels)"
									width="88px"
									height="31px"
								/></a
							>
							<a
								href="https://districts.nekoweb.org/"
								target="_blank"
								><Image
									alt="Nekoweb Districts"
									title="Nekoweb Districts"
									src="https://districts.nekoweb.org/img/districts002.png"
									width="88px"
									height="31px"
								/>
								<a
									target="_blank"
									class="w-fit shrink-0"
									href="https://kalechips.net/responsive/index"
								>
									<Image
										src="/imgs/buttons/responsive-web-directory.png"
										alt="Responsive Web Directory"
										title="Responsive Web Directory"
										width="88px"
										height="31px"
									/>
								</a>
								<Image
									src="/imgs/buttons/mobilefriendly.png"
									alt="Mobile friendly"
									title="This site is mobile friendly!"
									width="88px"
									height="31px"
								/>
							</a>
						</div>
					</footer>
				</div>
			</main>
			<aside data-active-page={id} id="sidebar">
				<nav transition:persist>
					<a id="index" href="/home/"><span class="ms">home</span> Home</a>
					<details>
						<summary>whereabouts</summary>
						<a id="about" href="/about/"
							><span class="ms">person</span> About JB</a
						>
						<a id="riiatw" href="/riiatw/"
							><span class="ms">language</span> RIIAtW</a
						>
					</details>
					<details>
						<summary>stuff</summary>
						<a id="chat" href="/chat/"
							><span class="ms">smart_toy</span> "AI" Chat</a
						>
						<a id="split-it" href="/utils/split-it/"
							><span class="ms">space_dashboard</span> Split It!</a
						>
					</details>
					<details>
						<summary>writing</summary>
						<a id="posts" href="/posts/"
							><span class="ms">article</span> Posts</a
						>
						<a id="tutorials" href="/tutorials/"
							><span class="ms">help</span> Tutorials</a
						>
					</details>
					<details>
						<summary>my webrings</summary>
						<a id="ssgring" href="/webrings/ssgring/"><span class="ms">build</span> SSGRing</a>
						<a id="responeko" href="/webrings/responeko/"><span class="ms">phone_android</span> Responeko</a>
					</details>
					<details>
						<summary>outlinks</summary>
						<a id="links" href="/links/"
							><span class="ms">link</span> Links</a
						>
						<a id="bookmarks" href="/bookmarks/"
							><span class="ms">bookmark</span> Bookmarks</a
						>
					</details>
					<details>
						<summary>liked my site?</summary>
						<a id="guestbook" href="/guestbook/"
							><span class="ms">contract_edit</span> Sign my Guestbook</a
						>
						<a href="https://nekoweb.org/follow/jbcarreon123"
							><span class="ms">add</span> Follow me on Nekoweb!</a
						>
					</details>
					<details>
						<summary>member of</summary>
						<a href="https://team.indieseas.net" target="_blank"
							>indiefellas <span class="ms">open_in_new</span></a
						>
						<a href="https://macro-deck.app" target="_blank"
							>Macro Deck <span class="ms">open_in_new</span></a
						>
					</details>
				</nav>
				<div class="sidetitle">
					<h1 class="page-title">{title ? title : "jb's site"}</h1>
					<p class="sec motd">your resident helper</p>
				</div>
			</aside>
		</div>
	</body>
</html>

