---
import Layout from "../../layouts/Layout.astro";
---

<Layout
    title="Nekoweb Sitebox Viewer"
    description="A viewer of a site box"
    id="nekoweb-sitebox"
>
    <script is:inline>
        let timeout = 0;

        /** @param {HTMLFormElement} el  */
        async function fChange(el) {
            let css = el.querySelector("textarea#css").value;
            let style = document.querySelector("#user-style");

            style.innerHTML = css
                ? css
                : `.site-box {
    text-align: center;
    background-image: url(/static/assets/cookiebox.png); /* Only nekoweb URLs allowed, use full url to your site like https://example.nekoweb.org/images/coolbg.png */
    background-repeat: no-repeat;
    color: #b08271;
    font-size: 12px;
}
.site-box > a > p {
    color: var(--darkbrown);
    font-weight: bold;
}
.site-box > a > span {
    color: var(--darkbrown);
}`;

            let overflow = el.querySelector(
                'input[type="checkbox"]#overflow',
            ).checked;
            console.log(overflow);
            document
                .querySelector(".pre-site")
                .style.setProperty(
                    "overflow",
                    overflow == false ? "hidden" : null,
                );

            let username = el.querySelector(`input[type="text"]#username`).value;
            clearTimeout(timeout);
            timeout = setTimeout(async () => {
                if (document.querySelector('#NOTUSEDINNEKOWEB_url').href == `//${username}.nekoweb.org/`) return;
                let res = await fetch('https://nekoweb.org/api/site/info/' + username);
                if (!res.ok) return;

                let json = await res.json();
                document.querySelector('#NOTUSEDINNEKOWEB_url').href = `//${username}.nekoweb.org/`;
                document.querySelector('#NOTUSEDINNEKOWEB_screenshot').src = `//nekoweb.org/screenshots/${username}/index_large.jpg`;
                document.querySelector('#NOTUSEDINNEKOWEB_siteurl').innerHTML = `${username}.nekoweb.org
                
                <span
                    style="position:relative!important"
                    class="noreset follow"
                    title="Follow">[+]</span
                >`;
                document.querySelector('#NOTUSEDINNEKOWEB_sitetitle').textContent = json.title;

                let follow = document.querySelector('.follow');
                follow.addEventListener('click', (ev) => {
                    ev.preventDefault();
                    follow.classList.toggle('following');
                    if (follow.classList.contains('following')) {
                        follow.textContent = '[-]';
                    } else {
                        follow.textContent = '[+]';
                    }
                });
            }, 1000)
        }

        document.addEventListener("astro:page-load", () => {
            fChange(document.querySelector("form"));

            document
                .querySelector("form textarea")
                .addEventListener("keydown", function (e) {
                    if (e.key == "Tab") {
                        e.preventDefault();
                        var start = this.selectionStart;
                        var end = this.selectionEnd;
                        this.value =
                            this.value.substring(0, start) +
                            " ".repeat(4) +
                            this.value.substring(end);
                        this.selectionStart = this.selectionEnd = start + 4;
                    }
                });
        });
    </script>

    <h1>Nekoweb Sitebox Viewer</h1>
    <p>A basic Nekoweb Sitebox viewer</p>

    <div id="cont" class="cont">
        <div id="out">
            <div class="pre-pre-site nekoweb-colors">
                <div class="pre-site" style="">
                    <div
                        id="site"
                        class="noreset site-box t-classic"
                        style="width:275px!important;height:190px!important;position:relative!important"
                    >
                        <span class="noreset top-dot"></span>
                        <a
                            href="//jbcarreon123.nekoweb.org/"
                            target="_blank"
                            id="NOTUSEDINNEKOWEB_url"
                            rel="noopener ugc"
                            style="position:relative!important"
                        >
                            <div
                                class="noreset sitefeature"
                                style="position:relative!important"
                            >
                                <img
                                    src="//nekoweb.org/screenshots/jbcarreon123/index_large.jpg"
                                    class="screenshot"
                                    id="NOTUSEDINNEKOWEB_screenshot"
                                    style="position:relative!important"
                                />
                            </div>
                            <p
                                class="noreset"
                                style="position:relative!important"
                                id="NOTUSEDINNEKOWEB_siteurl"
                            >
                                jbcarreon123.nekoweb.org

                                <span
                                    style="position:relative!important"
                                    class="noreset follow"
                                    title="Follow">[+]</span
                                >
                            </p>
                            <span
                                class="noreset"
                                style="position:relative!important"
                                id="NOTUSEDINNEKOWEB_sitetitle"
                                >site title</span
                            >
                            <br />
                        </a>
                        <span class="noreset bottom-dot"></span>
                    </div>
                </div>
            </div>
        </div>
        <div id="left">
            <form class="w-full" oninput="fChange(this)">
                <div>
                    <input type="checkbox" id="overflow" checked="true" />
                    <label for="overflow">Allow overflowing (do you have Nekoweb Supporter)?</label>
                </div>
                <div>
                    <label for="username">Nekoweb Username ([username].nekoweb.org)</label><br />
                    <input type="text" id="username" value="jbcarreon123" />
                </div>
                <div>
                    <label for="css">Your CSS</label><br />
                    <textarea
                        class="w-full border"
                        id="css"
                        set:html=`.site-box {
    text-align: center;
    background-image: url(/static/assets/cookiebox.png); /* Only nekoweb URLs allowed, use full url to your site like https://example.nekoweb.org/images/coolbg.png */
    background-repeat: no-repeat;
    color: #b08271;
    font-size: 12px;
}
.site-box > a > p {
    color: var(--darkbrown);
    font-weight: bold;
}
.site-box > a > span {
    color: var(--darkbrown);
}`
                    />
                </div>
            </form>
        </div>
    </div>

    <style is:inline>
        .cont {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding-top: 12px;
        }

        form > div {
            padding-top: 12px;
            padding: 10px;
        }

        form {
            padding-bottom: 12px;
        }

        textarea {
            height: 300px;
        }

        #css {
            width: 100%;
        }

        @media (width <= 640px) {
            .cont {
                grid-template-columns: repeat(1, minmax(100px, 1fr));
            }
        }

        #out {
            background-color: #fff9e6;
            padding: 6px;
            box-sizing: border-box;
            margin: 0 auto;

            * {
                box-sizing: border-box;
                overflow-wrap: initial;
            }
        }

        /* NEKOWEB SITE BOX STYLES: DEFAULT [DO NOT REMOVE] */
        .pre-pre-site {
            font:
                11pt "MS PGothic",
                Tahoma,
                Verdana;
            margin: 18px;
            vertical-align: middle;
            display: inline-block !important;
            width: 280px;
            height: 197px !important;
        }

        .pre-site {
            position: relative;
            display: inline-block !important;
            width: 280px !important;
            height: 195px !important;
        }

        .follow {
            cursor: pointer;
            font-size: 12px;
        }

        .pre-site a {
            text-decoration: none;
        }

        .pre-site p {
            color: var(--darkbrown);
            font-weight: bold;
            display: block;
            margin-top: 1px;
            margin-bottom: 2px;
            font-size: 16px;
        }

        .sitefeature {
            margin-top: 13px;
            margin-left: 15px;
            height: 137px;
            width: 244px;
            background-image: url("/static/assets/previewplaceholder.png");
            background-color: white;
            border: 1px solid #ecbfa6;
        }

        .screenshot {
            width: 100%;
            height: 100%;
        }

        .site-box {
            text-align: center;
            background-image: url("/static/assets/cookiebox.png");
            background-repeat: no-repeat;
            width: 228px;
            height: 160px;
            display: inline-block;
            position: relative;
            margin: 4px;
            color: #b08271;
            font-size: 12px;
        }

        .post-link {
            text-decoration: none;
        }

        .post-box {
            background-color: #fff2cc;
            border: 4px solid #ecbfa6;
            padding: 15px;
            border-radius: 5px;
            color: #634c53;
            font-weight: normal;
        }

        .post-title {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 0px;
        }

        .nekoweb-colors {
            --almostwhite: #fff2cc;
            --cream: #fff2cc;
            --orange: #ffc09b;
            --peach: #ffbbba;
            --lightgreen: #ffe1b6;
            --peachier: #ffbbba;
            --orangish: #ffc09b;
            --creamish: #ffecd6;
            --pink: #fc949f;
            --link: #ea8988;
            --purple: #fc949f;
            --palegreen: #bbd8bb;
            --gray: #d5d5d5;
            --lightbrown: #825044;
            --darkbrown: #634c53;
            --cookie: #875f6b;
            --dough: #ffd0bc;
            --light-red: #b95c5c;
            --crazy-green: #95e995;
            --gradientorange: linear-gradient(#fff2df, #fadabe);
        }
    </style>

    <style is:inline id="user-style">
        .site-box {
            text-align: center;
            background-image: url(/static/assets/cookiebox.png); /* Only nekoweb URLs allowed, use full url to your site like https://example.nekoweb.org/images/coolbg.png */
            background-repeat: no-repeat;
            color: #b08271;
            font-size: 12px;
        }
        .site-box > a > p {
            color: var(--darkbrown);
            font-weight: bold;
        }
        .site-box > a > span {
            color: var(--darkbrown);
        }
    </style>
</Layout>
